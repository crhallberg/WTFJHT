name: Notify Slack on New File in _posts

on:
  push:
    branches:
      - master
    paths:
      - '_posts/**'
  workflow_dispatch: # Allows manual triggering from GitHub UI

jobs:
  notify_slack:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Check for new files
        run: |
          NEW_FILES=$(git diff --diff-filter=A --name-only HEAD^ HEAD _posts/)
          if [[ -n "$NEW_FILES" ]]; then
            MESSAGE="New files added to _posts:\n"
            for FILE in $NEW_FILES; do
              URL="https://github.com/mkiser/WTFJHT/blob/master/${FILE}"
              MESSAGE+="<${URL}|${FILE}>\n"
            done
            echo "$MESSAGE"
            # Add Slack notification step here
          else
            echo "No new files added to _posts."
          fi
      - name: Send message to Slack
        if: steps.files.outputs.message != 'No new files added to _posts.'
        run: |
          curl -X POST -H 'Content-type: application/json' --data '{"text":"${{ steps.files.outputs.message }}"}' ${{ secrets.SLACK_WEBHOOK_URL }}
